/**
*
* AjaxListener.js: listen to any AJAX event on page, even by other scripts
* version 1.1.0
* https://github.com/foo123/AjaxListener.js
*
**/
!function(e,t){"use strict";e[t]=function(){"use strict";var r={VERSION:"1.1.0"},l=[],n=false,s=Object.prototype.hasOwnProperty,e=Object.prototype.toString,t=Function.prototype.toString,o=/[\r\n]+/,i=/^[^\[\]\.]+(\[[^\[\]\.]+\])+(\[\])?$/,u=/\[([^\[\]]+)\]/g,a=/^\s*function\s*[A-Za-z0-9_$]+\s*\([^\(\)]*\)\s*\{\s*\[native code\]\s*\}\s*$/i,f=window.fetch,c=window.XMLHttpRequest,p,d,h;function g(){return window.location.origin+window.location.pathname}function w(n){return"[object String]"===e.call(n)}function y(n){return"function"===typeof n&&a.test(t.call(n))}function m(n){return window.FormData&&n instanceof window.FormData}function v(n){return i.test(n)?n.replace(u,".$1").split(".").map(function(n){return decodeURIComponent(n)}):[decodeURIComponent(n)]}function L(n,e,t){for(var r,o=0,i=e.length;o<i;++o){r=e[o];if(o+1<i){if(!s.call(n,r))n[r]={};n=n[r]}else{if("[]"===r.slice(-2))r=r.slice(0,-2);if(s.call(n,r)){if(n[r].push)n[r].push(t);else n[r]=[n[r],t]}else{n[r]=t}}}}function R(n,e){return String(n).trim().split("&").reduce(function(n,e){e=e.split("=");var t=e[0].length?v(e[0]):null;if(t&&t.length)L(n,t,e[1]?e[1].length?decodeURIComponent(e[1]):"":true);return n},e||{})}function x(n){return JSON.parse(n)}function j(r,n){return Array.from(r.keys()).reduce(function(n,e){var t=r.getAll(e);n[e]=1===t.length?t[0]:t;return n},n||{})}function S(n){return String(n).trim().split(o).reduce(function(n,e){e=e.trim();if(e.length){var t=e.split(": "),r=t.shift(),o=t.join(": ");n[r.toLowerCase()]=o}return n},{})}function O(t){return Array.from(t.keys()).reduce(function(n,e){n[e.toLowerCase()]=t.get(e);return n},{})}function U(t){return"function"===typeof t.keys&&"function"===typeof t.get?O(t):Object.keys(t).reduce(function(n,e){n[e.toLowerCase()]=t[e];return n},{})}function q(n,e){return"function"===typeof n?function(){return n(e)}:function(){return e}}function A(r,o){setTimeout(function(){for(var n=l.slice(),e=0,t=n.length;e<t;++e)n[e](r,o);r.dispose();o.dispose();r=null;o=null},0)}function H(n,e,t,r,o){var i=this,u=null,l=null,s=null;e=String(e).toUpperCase();i.dispose=function(){t=null;r=null;o=null;e=null;u=null;l=null;s=null;return i};i.getAPI=function(){return n};i.getMethod=function(){return e};i.getURL=function(n){if(true===n)return t;if(null==u&&null!=t){var e=new window.URL(t,g());u={href:e.href,origin:e.origin,hostname:e.hostname,protocol:e.protocol,host:e.host,port:e.port,path:e.pathname,query:e.search,hash:e.hash,queryParams:e.search&&e.search.length?R(e.search.slice(1)):{}}}return u};i.getHeaders=function(){if(null==l&&null!=r){l=r()}return l};i.getBody=function(n){if(true===n)return o;if(null==s&&null!=o){if(m(o)){s=j(o)}else if(w(o)){var e=String(i.getHeaders()["content-type"]||"");if(-1!==e.indexOf("application/x-www-form-urlencoded")){s=R(o)}else if(-1!==e.indexOf("application/json")||-1!==e.indexOf("application/vnd.api+json")){s=x(o)}else{s=o}}else{s=o}}return s}}function b(n,e,t,r,o){var i=this,u=null,l=null,s=null;i.dispose=function(){e=null;t=null;r=null;o=null;u=null;l=null;s=null;return i};i.getAPI=function(){return n};i.getStatus=function(){return e};i.getURL=function(n){if(true===n)return t;if(null==u&&null!=t){var e=new window.URL(t,g());u={href:e.href,origin:e.origin,hostname:e.hostname,protocol:e.protocol,host:e.host,port:e.port,path:e.pathname,query:e.search,hash:e.hash,queryParams:e.search&&e.search.length?R(e.search.slice(1)):{}}}return u};i.getHeaders=function(){if(null==l&&null!=r){l=r()}return l};i.getBody=function(n){if(true===n)return o;if(null==s&&null!=o){if(w(o)){var e=String(i.getHeaders()["content-type"]||"");if(-1!==e.indexOf("application/x-www-form-urlencoded")){s=R(o)}else if(-1!==e.indexOf("application/json")||-1!==e.indexOf("application/vnd.api+json")){s=x(o)}else{s=o}}else{s=o}}return s}}function E(r){var n=arguments,o=(1<n.length?n[1]:{})||{};return new Promise(function(e,t){f.apply(window,n).then(function(n){e(n);if(l.length){A(r instanceof window.Request?new H("fetch",r.method,r.url,q(O,r.headers),r.body):new H("fetch",o.method||"GET",r,q(U,o.headers||{}),o.body||""),new b("fetch",n.status,n.url||r.url,q(O,n.headers),n.body))}}).catch(function(n){t(n)})})}function I(t,r){var o=this,i=null,u={},n;o.send=function(){if(arguments.length)i=arguments[0];return d.apply(o,arguments)};o.setRequestHeader=function(n,e){var t=String(n).toLowerCase();u[t]=s.call(u,t)?u[t]+", "+String(e):String(e);return h.apply(o,arguments)};n=function n(e){o.removeEventListener("load",n);o.removeEventListener("error",n);o.removeEventListener("abort",n);if("load"===e.type&&l.length){A(new H("xhr",t,r,q(null,u),null==i?"":i),new b("xhr",o.status,o.responseURL&&o.responseURL.length?o.responseURL:r,q(S,o.getAllResponseHeaders()),o.responseText))}};o.addEventListener("load",n);o.addEventListener("error",n);o.addEventListener("abort",n);if(arguments.length<1)t="GET";if(arguments.length<2)r="";return p.apply(o,arguments)}return H.prototype={constructor:H,dispose:null,getAPI:null,getMethod:null,getURL:null,getHeaders:null,getBody:null},r.Request=H,b.prototype={constructor:b,dispose:null,getAPI:null,getStatus:null,getURL:null,getHeaders:null,getBody:null},r.Response=b,(I.ajaxListener=E.ajaxListener=r).install=function(){return n||(f&&(f.ajaxListener&&(f.ajaxListener.uninstall(),f=window.fetch),y(f)&&(window.fetch=E,n=!0)),c&&(c.prototype.open.ajaxListener&&c.prototype.open.ajaxListener.uninstall(),y(c.prototype.open)&&(p=c.prototype.open,d=c.prototype.send,h=c.prototype.setRequestHeader,c.prototype.open=I,n=!0))),r},r.isInstalled=function(){return n},r.uninstall=function(){return n&&(y(f)&&(window.fetch=f),y(p)&&(c.prototype.open=p),h=d=p=null,n=!1),r},r.onRequest=function(n,e){var t;return"function"==typeof n&&(t=l.indexOf(n),!1===e?-1!==t&&l.splice(t,1):-1===t&&l.push(n)),r},r}(),"function"==typeof define&&define.amd&&define(function(n){return e[t]})}("undefined"!=typeof self?self:this,"AjaxListener");