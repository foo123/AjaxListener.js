/**
*
* AjaxListener.js: listen to any AJAX event on page, even by other scripts
* version 1.2.0
* https://github.com/foo123/AjaxListener.js
*
**/
!function(e,t){"use strict";e[t]=function(){"use strict";var r={VERSION:"1.2.0"},p=[],n=false,l=Object.prototype.hasOwnProperty,e=Object.prototype.toString,t=Function.prototype.toString,o=/[\r\n]+/,i=/^[^\[\]\.]+(\[[^\[\]\.]+\])+(\[\])?$/,u=/\[([^\[\]]+)\]/g,s=/^\s*function\s*[A-Za-z0-9_$]+\s*\([^\(\)]*\)\s*\{\s*\[native code\]\s*\}\s*$/i,f=window.fetch,c=window.XMLHttpRequest,d=window.Request,a,h,g;function w(){return window.location.origin+window.location.pathname}function y(n){return"[object String]"===e.call(n)}function m(n){return"function"===typeof n&&s.test(t.call(n))}function v(n){return window.FormData&&n instanceof window.FormData}function L(n){return i.test(n)?n.replace(u,".$1").split(".").map(function(n){return decodeURIComponent(n)}):[decodeURIComponent(n)]}function R(n,e,t){for(var r,o=0,i=e.length;o<i;++o){r=e[o];if(o+1<i){if(!l.call(n,r))n[r]={};n=n[r]}else{if("[]"===r.slice(-2))r=r.slice(0,-2);if(l.call(n,r))if(n[r].push)n[r].push(t);else n[r]=[n[r],t];else n[r]=t}}}function x(n,e){return String(n).trim().split("&").reduce(function(n,e){e=e.split("=");var t=e[0].length?L(e[0]):null;if(t&&t.length)R(n,t,e[1]?e[1].length?decodeURIComponent(e[1]):"":true);return n},e||{})}function j(n){return JSON.parse(n)}function O(r,n){return Array.from(r.keys()).reduce(function(n,e){var t=r.getAll(e);n[e]=1===t.length?t[0]:t;return n},n||{})}function T(n){return String(n).trim().split(o).reduce(function(n,e){e=e.trim();if(e.length){var t=e.split(": "),r=t.shift(),o=t.join(": ");n[r.toLowerCase()]=o}return n},{})}function S(t){return Array.from(t.keys()).reduce(function(n,e){n[e.toLowerCase()]=t.get(e);return n},{})}function b(t){return"function"===typeof t.keys&&"function"===typeof t.get?S(t):Object.keys(t).reduce(function(n,e){n[e.toLowerCase()]=t[e];return n},{})}function q(n,e){return"function"===typeof n?function(){return n(e)}:function(){return e}}function P(r,o){setTimeout(function(){for(var n=p.slice(),e=0,t=n.length;e<t;++e)n[e](r,o);r.dispose();o.dispose();r=null;o=null},0)}function U(n,e,t,r,o){var i=this,u=null,l=null,s=null;e=String(e).toUpperCase();i.dispose=function(){t=null;r=null;o=null;e=null;u=null;l=null;s=null;return i};i.getAPI=function(){return n};i.getMethod=function(){return e};i.getURL=function(n){if(true===n)return t;if(null==u&&null!=t){var e=new window.URL(t,w());u={href:e.href,origin:e.origin,hostname:e.hostname,protocol:e.protocol,host:e.host,port:e.port,path:e.pathname,query:e.search,hash:e.hash,queryParams:e.search&&e.search.length?x(e.search.slice(1)):{}}}return u};i.getHeaders=function(){if(null==l&&null!=r)l=r();return l};i.getBody=function(n){if(true===n)return o;if(null==s&&null!=o)if(v(o))s=O(o);else if(y(o)){var e=String(i.getHeaders()["content-type"]||"");if(-1!==e.indexOf("application/x-www-form-urlencoded"))s=x(o);else if(-1!==e.indexOf("application/json")||-1!==e.indexOf("application/vnd.api+json"))s=j(o);else s=o}else s=o;return s}}function A(n,e,t,r,o){var i=this,u=null,l=null,s=null;i.dispose=function(){e=null;t=null;r=null;o=null;u=null;l=null;s=null;return i};i.getAPI=function(){return n};i.getStatus=function(){return e};i.getURL=function(n){if(true===n)return t;if(null==u&&null!=t){var e=new window.URL(t,w());u={href:e.href,origin:e.origin,hostname:e.hostname,protocol:e.protocol,host:e.host,port:e.port,path:e.pathname,query:e.search,hash:e.hash,queryParams:e.search&&e.search.length?x(e.search.slice(1)):{}}}return u};i.getHeaders=function(){if(null==l&&null!=r)l=r();return l};i.getBody=function(n){if(true===n)return o;if(null==s&&null!=o)if(y(o)){var e=String(i.getHeaders()["content-type"]||"");if(-1!==e.indexOf("application/x-www-form-urlencoded"))s=x(o);else if(-1!==e.indexOf("application/json")||-1!==e.indexOf("application/vnd.api+json"))s=j(o);else s=o}else s=o;return s}}function H(n,e){var t=new d(n,e),r=e?e.body:"";t.getOriginalBody=function(){return r};return t}function B(c){var n=arguments,a=(1<n.length?n[1]:{})||{};return new Promise(function(t,e){f.apply(window,n).then(function(r){if(p.length){var n=r.arrayBuffer,o=r.blob,i=r.formData,u=r.json,l=r.text,s=r.body,e=null,f=function n(){clearTimeout(e);P(c instanceof d?new U("fetch",c.method,c.url,q(S,c.headers),c.getOriginalBody?c.getOriginalBody():c.body):new U("fetch",a.method||"GET",c,q(b,a.headers||{}),a.body||""),new A("fetch",r.status,r.url||c.url,q(S,r.headers),s))};e=setTimeout(f,500);r.arrayBuffer=function(){return new Promise(function(e,t){n.call(r).then(function(n){s=n;setTimeout(f,0);e(n)}).catch(function(n){setTimeout(f,0);t(n)})})};r.blob=function(){return new Promise(function(e,t){o.call(r).then(function(n){s=n;setTimeout(f,0);e(n)}).catch(function(n){setTimeout(f,0);t(n)})})};r.formData=function(){return new Promise(function(e,t){i.call(r).then(function(n){s=n;setTimeout(f,0);e(n)}).catch(function(n){setTimeout(f,0);t(n)})})};r.json=function(){return new Promise(function(e,t){u.call(r).then(function(n){s=n;setTimeout(f,0);e(n)}).catch(function(n){setTimeout(f,0);t(n)})})};r.text=function(){return new Promise(function(e,t){l.call(r).then(function(n){s=n;setTimeout(f,0);e(n)}).catch(function(n){setTimeout(f,0);t(n)})})};t(r)}else t(r)}).catch(function(n){e(n)})})}function E(t,r){var o=this,i=null,u={},n;o.send=function(){if(arguments.length)i=arguments[0];return h.apply(o,arguments)};o.setRequestHeader=function(n,e){var t=String(n).toLowerCase();u[t]=l.call(u,t)?u[t]+", "+String(e):String(e);return g.apply(o,arguments)};n=function n(e){o.removeEventListener("load",n);o.removeEventListener("error",n);o.removeEventListener("abort",n);if("load"===e.type&&p.length)P(new U("xhr",t,r,q(null,u),null==i?"":i),new A("xhr",o.status,o.responseURL&&o.responseURL.length?o.responseURL:r,q(T,o.getAllResponseHeaders()),o.responseText))};o.addEventListener("load",n);o.addEventListener("error",n);o.addEventListener("abort",n);if(arguments.length<1)t="GET";if(arguments.length<2)r="";return a.apply(o,arguments)}return U.prototype={constructor:U,dispose:null,getAPI:null,getMethod:null,getURL:null,getHeaders:null,getBody:null},r.Request=U,A.prototype={constructor:A,dispose:null,getAPI:null,getStatus:null,getURL:null,getHeaders:null,getBody:null},r.Response=A,(E.ajaxListener=B.ajaxListener=r).install=function(){if(!n){if(f){if(f.ajaxListener){f.ajaxListener.uninstall();f=window.fetch;d=window.Request}if(m(f)){window.fetch=B;if(m(d))window.Request=H;n=true}}if(c){if(c.prototype.open.ajaxListener)c.prototype.open.ajaxListener.uninstall();if(m(c.prototype.open)){a=c.prototype.open;h=c.prototype.send;g=c.prototype.setRequestHeader;c.prototype.open=E;n=true}}}return r},r.isInstalled=function(){return n},r.uninstall=function(){if(n){if(m(f)){window.fetch=f;window.Request=d}if(m(a))c.prototype.open=a;a=null;h=null;g=null;n=false}return r},r.onRequest=function(n,e){if("function"===typeof n){var t=p.indexOf(n);if(false===e){if(-1!==t)p.splice(t,1)}else if(-1===t)p.push(n)}return r},r}(),"function"==typeof define&&define.amd&&define(function(n){return e[t]})}("undefined"!=typeof self?self:this,"AjaxListener");