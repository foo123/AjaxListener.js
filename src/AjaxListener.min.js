/**
*
* AjaxListener.js: listen to any AJAX event on page, even by other scripts
* version 1.0.0
* https://github.com/foo123/AjaxListener.js
*
**/
!function(e,n){"use strict";e[n]=function(){"use strict";var s={VERSION:"1.0.0"},l=[],t=false,a=Object.prototype.hasOwnProperty,e=/[\r\n]+/,n=window.fetch,h=window.XMLHttpRequest,d;function r(t){return String(t).trim().split("&").reduce(function(t,e){e=e.split("=");var n=e[0].length?decodeURIComponent(e[0]):null,s=e[1]&&e[1].length?decodeURIComponent(e[1]):true;if(n){if(a.call(t,n)){if(t[n].push)t[n].push(s);else t[n]=[t[n],s]}else{t[n]=s}}return t},{})}function i(t){return String(t).trim().split(e).reduce(function(t,e){e=e.trim();if(e.length){var n=e.split(": "),s=n.shift(),r=n.join(": ");t[s]=r}return t},{})}function f(s,r){setTimeout(function(){for(var t=l.slice(),e=0,n=t.length;e<n;++e)t[e](s,r);s.dispose();r.dispose()},0)}function c(t){this.type=t}function p(t){this.type=t}function o(r){return n.apply(n,arguments).then(function(e){if(l.length){var n=new c("fetch"),s=new p("fetch");e.text().then(function(t){s.setStatus(e.status).setHeaders(e.headers).setBody(t);if(r instanceof window.Request){n.setMethod(r.method).setUrl(r.url).setHeaders(r.headers);r.text().then(function(t){n.setBody(t);f(n,s)})}else{n.setMethod("GET").setUrl(r);f(n,s)}})}return e})}function u(s,r){var i=this,o=null,u={},e=h.prototype.send,n=h.prototype.setRequestHeader;i.send=function(t){if(arguments.length<1)t=null;o=t;e.apply(i,arguments)};i.setRequestHeader=function(t,e){u[t]=a.call(u,t)?u[t]+", "+String(e):String(e);n.apply(i,arguments)};if(arguments.length<1)s="GET";if(arguments.length<2)r="";i.addEventListener("load",function t(){i.removeEventListener("load",t);if(l.length){var e=new c("xhr"),n=new p("xhr");e.setMethod(s).setUrl(r).setHeaders(u).setBody(o);n.setStatus(i.status).setHeaders(i.getAllResponseHeaders()).setBody(i.responseText);f(e,n)}});d.apply(i,arguments)}return c.prototype={constructor:c,type:"",_method:"GET",_url:null,_headers:null,_body:null,dispose:function(){return this._method=null,this._url=null,this._headers=null,this._body=null,this},setMethod:function(t){return this._method=String(t).toUpperCase(),this},getMethod:function(){return this._method},setUrl:function(t){return this._url=t,this},getUrl:function(t){var e=this._url;return!0===t?e:e?(t=e.split("?"))[1]?(t[1]=t[1].split("#"),t[1][1]?{url:t[0],search:r(t[1][0]),hash:t[1][1]}:{url:t[0],search:r(t[1][0]),hash:null}):(t[0]=t[0].split("#"),t[0][1]?{url:t[0][0],search:null,hash:t[0][1]}:{url:e,search:null,hash:null}):void 0},setHeaders:function(t){return this._headers=t,this},getHeaders:function(t){var n=this._headers;return!0===t?n:n?n.keys&&header.get?Array.from(n.keys()).reduce(function(t,e){return t[e]=n.get(e),t},{}):n.substring?i(n):n:void 0},setBody:function(t){return this._body=t,this},getBody:function(t){var n=this._body;return!0===t?n:n?window.FormData&&n instanceof window.FormData?Array.from(n.keys()).reduce(function(t,e){return t[e]=n.getAll(e),t},{}):"json"===t?JSON.parse(n):"urlenc"===t?r(n):n:void 0}},s.Request=c,p.prototype={constructor:p,type:"",_status:0,_headers:null,_body:null,dispose:function(){return this._status=null,this._headers=null,this._body=null,this},setStatus:function(t){return this._status=t,this},getStatus:function(){return this._status},setHeaders:function(t){return this._headers=t,this},getHeaders:function(t){var n=this._headers;return!0===t?n:n?n.keys&&header.get?Array.from(n.keys()).reduce(function(t,e){return t[e]=n.get(e),t},{}):n.substring?i(n):n:void 0},setBody:function(t){return this._body=t,this},getBody:function(){return this._body}},s.Response=p,(u.ajaxListener=o.ajaxListener=s).install=function(){return t||(t=!0,n&&(n.ajaxListener&&(n.ajaxListener.uninstall(),n=window.fetch),window.fetch=o),h&&(h.prototype.open.ajaxListener&&h.prototype.open.ajaxListener.uninstall(),d=h.prototype.open,h.prototype.open=u)),s},s.isInstalled=function(){return t},s.uninstall=function(){return t&&(n&&(window.fetch=n),h&&(h.prototype.open=d),d=null,t=!1),s},s.onRequest=function(t,e){var n;return"function"==typeof t&&(n=l.indexOf(t),!1===e?-1!==n&&l.splice(n,1):-1===n&&l.push(t)),s},s}(),"function"==typeof define&&define.amd&&define(function(t){return e[n]})}("undefined"!=typeof self?self:this,"AjaxListener");