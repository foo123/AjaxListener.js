/**
*
* AjaxListener.js: listen to any AJAX event on page, even by other scripts
* version 1.0.0
* https://github.com/foo123/AjaxListener.js
*
**/
!function(e,n){"use strict";e[n]=function(){"use strict";var r={VERSION:"1.0.0"},a=[],t=false,f=Object.prototype.hasOwnProperty,e=/[\r\n]+/,n=/^[^\[\]\.]+(\[[^\[\]\.]+\])+$/,i=/\[([^\[\]]+)\]/g,s=window.fetch,o=window.XMLHttpRequest,d;function u(t){return window.FormData&&t instanceof window.FormData}function l(t){return n.test(t)?t.trim().replace(i,".$1").split(".").map(function(t){return decodeURIComponent(t.trim())}):[decodeURIComponent(t)]}function c(t,e,n){for(var r,i=0,s=e.length;i<s;++i){r=e[i];if(i+1<s){if(!f.call(t,r))t[r]={};t=t[r]}else if(f.call(t,r)){if(t[r].push)t[r].push(n);else t[r]=[t[r],n]}else{t[r]=n}}}function h(t,e){return String(t).trim().split("&").reduce(function(t,e){e=e.split("=");var n=e[0].length?l(e[0]):null;if(n&&n.length)c(t,n,e[1]?e[1].length?decodeURIComponent(e[1]):"":true);return t},e||{})}function p(t){return JSON.parse(t)}function y(t,e){return Array.from(r.keys()).reduce(function(t,e){var n=r.getAll(e);return t[e]=1===n.length?n[0]:n,t},e||{})}function g(t){return String(t).trim().split(e).reduce(function(t,e){e=e.trim();if(e.length){var n=e.split(": "),r=n.shift(),i=n.join(": ");t[r.toLowerCase()]=i}return t},{})}function w(n){return Array.from(n.keys()).reduce(function(t,e){t[e.toLowerCase()]=n.get(e);return t},{})}function _(t,e){return"function"===typeof t?function(){return t(e)}:function(){return e}}function m(r,i){setTimeout(function(){for(var t=a.slice(),e=0,n=t.length;e<n;++e)t[e](r,i);r.dispose();i.dispose()},0)}function v(t){this.type=t}function x(t){this.type=t}function H(i){return s.apply(s,arguments).then(function(e){if(a.length){var n=new v("fetch"),r=new x("fetch");e.text().then(function(t){r.setStatus(e.status).setHeaders(_(w,e.headers)).setBody(t);if(i instanceof window.Request){n.setMethod(i.method).setUrl(i.url).setHeaders(_(w,i.headers));i.text().then(function(t){n.setBody(t||"");m(n,r)})}else{n.setMethod("GET").setUrl(i).setHeaders(_(null,{})).setBody("");m(n,r)}})}return e})}function S(r,i){var s=this,o=null,u={},t=s.send,l=s.setRequestHeader;s.send=function(){if(arguments.length)o=arguments[0];t.apply(s,arguments)};s.setRequestHeader=function(t,e){var n=String(t).toLowerCase();u[n]=f.call(u,n)?u[n]+", "+String(e):String(e);l.apply(s,arguments)};if(arguments.length<1)r="GET";if(arguments.length<2)i="";s.addEventListener("load",function t(){s.removeEventListener("load",t);if(a.length){var e=new v("xhr"),n=new x("xhr");e.setMethod(r).setUrl(i).setHeaders(_(null,u)).setBody(null==o?"":o);n.setStatus(s.status).setHeaders(_(g,s.getAllResponseHeaders())).setBody(s.responseText);m(e,n)}});d.apply(s,arguments)}return v.prototype={constructor:v,type:"",_method:"GET",_url:null,_headers:null,_body:null,dispose:function(){return this._method=null,this._url=null,this._headers=null,this._body=null,this},setMethod:function(t){return this._method=String(t).toUpperCase(),this},getMethod:function(){return this._method},setUrl:function(t){return this._url=t,this},getUrl:function(t){var e=this._url;return!0!==t&&null!=e?(t=e.split("?"))[1]?(t[1]=t[1].split("#"),t[1][1]?{url:t[0],query:h(t[1][0]),hash:t[1][1]}:{url:t[0],query:h(t[1][0]),hash:null}):(t[0]=t[0].split("#"),t[0][1]?{url:t[0][0],query:null,hash:t[0][1]}:{url:e,query:null,hash:null}):e},setHeaders:function(t){return this._headers=t,this},getHeaders:function(){var t=this._headers;if(t)return t()},setBody:function(t){return this._body=t,this},getBody:function(t){var r,e,n=this._body;if(!0===t)return n;if(null!=n){if(t=n,window.FormData&&t instanceof window.FormData)return r=n,Array.from(r.keys()).reduce(function(t,e){var n=r.getAll(e);return t[e]=1===n.length?n[0]:n,t},e||{});if(-1!==(e=String(this.getHeaders()["content-type"]||"")).indexOf("application/x-www-form-urlencoded"))return h(n);if(-1!==e.indexOf("application/json")||-1!==e.indexOf("application/vnd.api+json"))return p(n)}return n}},r.Request=v,x.prototype={constructor:x,type:"",_status:0,_headers:null,_body:null,dispose:function(){return this._status=null,this._headers=null,this._body=null,this},setStatus:function(t){return this._status=t,this},getStatus:function(){return this._status},setHeaders:function(t){return this._headers=t,this},getHeaders:function(){var t=this._headers;if(t)return t()},setBody:function(t){return this._body=t,this},getBody:function(t){var e=this._body;return!0===t||null==e||-1===(t=String(this.getHeaders()["content-type"]||"")).indexOf("application/json")&&-1===t.indexOf("application/vnd.api+json")?e:p(e)}},r.Response=x,(S.ajaxListener=H.ajaxListener=r).install=function(){return t||(t=!0,s&&(s.ajaxListener&&(s.ajaxListener.uninstall(),s=window.fetch),window.fetch=H),o&&(o.prototype.open.ajaxListener&&o.prototype.open.ajaxListener.uninstall(),d=o.prototype.open,o.prototype.open=S)),r},r.isInstalled=function(){return t},r.uninstall=function(){return t&&(s&&(window.fetch=s),o&&(o.prototype.open=d),d=null,t=!1),r},r.onRequest=function(t,e){var n;return"function"==typeof t&&(n=a.indexOf(t),!1===e?-1!==n&&a.splice(n,1):-1===n&&a.push(t)),r},r}(),"function"==typeof define&&define.amd&&define(function(t){return e[n]})}("undefined"!=typeof self?self:this,"AjaxListener");