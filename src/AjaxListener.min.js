/**
*
* AjaxListener.js: listen to any AJAX event on page, even by other scripts
* version 1.0.2
* https://github.com/foo123/AjaxListener.js
*
**/
!function(n,t){"use strict";n[t]=function(){"use strict";var r={VERSION:"1.0.2"},p=[],e=false,l=Object.prototype.hasOwnProperty,n=Function.prototype.toString,t=/[\r\n]+/,o=/^[^\[\]\.]+(\[[^\[\]\.]+\])+(\[\])?$/,i=/\[([^\[\]]+)\]/g,u=/^\s*function\s*[A-Za-z0-9_$]+\s*\([^\(\)]*\)\s*\{\s*\[native code\]\s*\}\s*$/i,s=window.fetch,a=window.XMLHttpRequest,f,c,d;function h(){return window.location.origin+window.location.pathname}function g(e){return"function"===typeof e&&u.test(n.call(e))}function w(e){return window.FormData&&e instanceof window.FormData}function y(e){return o.test(e)?e.replace(i,".$1").split(".").map(function(e){return decodeURIComponent(e)}):[decodeURIComponent(e)]}function m(e,n,t){for(var r,o=0,i=n.length;o<i;++o){r=n[o];if(o+1<i){if(!l.call(e,r))e[r]={};e=e[r]}else{if("[]"===r.slice(-2))r=r.slice(0,-2);if(l.call(e,r)){if(e[r].push)e[r].push(t);else e[r]=[e[r],t]}else{e[r]=t}}}}function v(e,n){return String(e).trim().split("&").reduce(function(e,n){n=n.split("=");var t=n[0].length?y(n[0]):null;if(t&&t.length)m(e,t,n[1]?n[1].length?decodeURIComponent(n[1]):"":true);return e},n||{})}function L(e){return JSON.parse(e)}function x(r,e){return Array.from(r.keys()).reduce(function(e,n){var t=r.getAll(n);e[n]=1===t.length?t[0]:t;return e},e||{})}function R(e){return String(e).trim().split(t).reduce(function(e,n){n=n.trim();if(n.length){var t=n.split(": "),r=t.shift(),o=t.join(": ");e[r.toLowerCase()]=o}return e},{})}function j(t){return Array.from(t.keys()).reduce(function(e,n){e[n.toLowerCase()]=t.get(n);return e},{})}function S(t){return"function"===typeof t.keys&&"function"===typeof t.get?j(t):Object.keys(t).reduce(function(e,n){e[n.toLowerCase()]=t[n];return e},{})}function O(e,n){return"function"===typeof e?function(){return e(n)}:function(){return n}}function P(r,o){setTimeout(function(){for(var e=p.slice(),n=0,t=e.length;n<t;++n)e[n](r,o);r.dispose();o.dispose();r=null;o=null},0)}function U(e,n,t,r,o){var i=this,u=null,l=null,s=null;n=String(n).toUpperCase();i.dispose=function(){t=null;r=null;o=null;n=null;u=null;l=null;s=null;return i};i.getAPI=function(){return e};i.getMethod=function(){return n};i.getURL=function(e){if(true===e)return t;if(null==u&&null!=t){var n=new window.URL(t,h());u={href:n.href,origin:n.origin,hostname:n.hostname,protocol:n.protocol,host:n.host,port:n.port,path:n.pathname,query:n.search,hash:n.hash,queryParams:n.search&&n.search.length?v(n.search.slice(1)):{}}}return u};i.getHeaders=function(){if(null==l&&null!=r){l=r()}return l};i.getBody=function(e){if(true===e)return o;if(null==s&&null!=o){if(w(o)){return s=x(o)}var n=String(i.getHeaders()["content-type"]||"");if(-1!==n.indexOf("application/x-www-form-urlencoded")){s=v(o)}else if(-1!==n.indexOf("application/json")||-1!==n.indexOf("application/vnd.api+json")){s=L(o)}else{s=o}}return s}}function q(e,n,t,r,o){var i=this,u=null,l=null,s=null;i.dispose=function(){n=null;t=null;r=null;o=null;u=null;l=null;s=null;return i};i.getAPI=function(){return e};i.getStatus=function(){return n};i.getURL=function(e){if(true===e)return t;if(null==u&&null!=t){var n=new window.URL(t,h());u={href:n.href,origin:n.origin,hostname:n.hostname,protocol:n.protocol,host:n.host,port:n.port,path:n.pathname,query:n.search,hash:n.hash,queryParams:n.search&&n.search.length?v(n.search.slice(1)):{}}}return u};i.getHeaders=function(){if(null==l&&null!=r){l=r()}return l};i.getBody=function(e){if(true===e)return o;if(null==s&&null!=o){var n=String(i.getHeaders()["content-type"]||"");if(-1!==n.indexOf("application/x-www-form-urlencoded")){s=v(o)}else if(-1!==n.indexOf("application/json")||-1!==n.indexOf("application/vnd.api+json")){s=L(o)}else{s=o}}return s}}function A(f){var e=arguments,c=(1<e.length?e[1]:{})||{};return new Promise(function(a,n){s.apply(window,e).then(function(t){if(p.length){var e,n=t.text.bind(t),r="",o="",i=undefined,u=undefined,l=null,s=null;t.text=function(){return Promise.resolve(o)};t.json=function(){return s?Promise.reject(s):Promise.resolve(u)};if(f instanceof window.Request){e=f.text.bind(f);f.text=function(){return Promise.resolve(r)};f.json=function(){return l?Promise.reject(l):Promise.resolve(i)}}n().then(function(n){o=n;try{u=JSON.parse(o)}catch(e){u=undefined;s=e}if(f instanceof window.Request){e().then(function(e){r=e;try{i=JSON.parse(r)}catch(e){i=undefined;l=e}a(t);P(new U("fetch",f.method,f.url,O(j,f.headers),e),new q("fetch",t.status,t.url||f.url,O(j,t.headers),n))})}else{a(t);P(new U("fetch",c.method||"GET",f,O(S,c.headers||{}),c.body||""),new q("fetch",t.status,t.url||f,O(j,t.headers),n))}})}else{a(t)}}).catch(function(e){n(e)})})}function H(t,r){var o=this,i=null,u={},e;o.send=function(){if(arguments.length)i=arguments[0];return c.apply(o,arguments)};o.setRequestHeader=function(e,n){var t=String(e).toLowerCase();u[t]=l.call(u,t)?u[t]+", "+String(n):String(n);return d.apply(o,arguments)};e=function e(n){o.removeEventListener("load",e);o.removeEventListener("error",e);o.removeEventListener("abort",e);if("load"===n.type&&p.length){P(new U("xhr",t,r,O(null,u),null==i?"":i),new q("xhr",o.status,o.responseURL&&o.responseURL.length?o.responseURL:r,O(R,o.getAllResponseHeaders()),o.responseText))}};o.addEventListener("load",e);o.addEventListener("error",e);o.addEventListener("abort",e);if(arguments.length<1)t="GET";if(arguments.length<2)r="";return f.apply(o,arguments)}return U.prototype={constructor:U,dispose:null,getAPI:null,getMethod:null,getURL:null,getHeaders:null,getBody:null},r.Request=U,q.prototype={constructor:q,dispose:null,getAPI:null,getStatus:null,getURL:null,getHeaders:null,getBody:null},r.Response=q,(H.ajaxListener=A.ajaxListener=r).install=function(){return e||(s&&(s.ajaxListener&&(s.ajaxListener.uninstall(),s=window.fetch),g(s)&&(window.fetch=A,e=!0)),a&&(a.prototype.open.ajaxListener&&a.prototype.open.ajaxListener.uninstall(),g(a.prototype.open)&&(f=a.prototype.open,c=a.prototype.send,d=a.prototype.setRequestHeader,a.prototype.open=H,e=!0))),r},r.isInstalled=function(){return e},r.uninstall=function(){return e&&(g(s)&&(window.fetch=s),g(f)&&(a.prototype.open=f),d=c=f=null,e=!1),r},r.onRequest=function(e,n){var t;return"function"==typeof e&&(t=p.indexOf(e),!1===n?-1!==t&&p.splice(t,1):-1===t&&p.push(e)),r},r}(),"function"==typeof define&&define.amd&&define(function(e){return n[t]})}("undefined"!=typeof self?self:this,"AjaxListener");