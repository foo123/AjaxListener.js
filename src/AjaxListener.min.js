/**
*
* AjaxListener.js: listen to any AJAX event on page, even by other scripts
* version 1.0.0
* https://github.com/foo123/AjaxListener.js
*
**/
!function(e,n){"use strict";e[n]=function(){"use strict";var r={VERSION:"1.0.0"},a=[],t=false,f=Object.prototype.hasOwnProperty,e=/[\r\n]+/,n=window.fetch,d=window.XMLHttpRequest,h;function s(t){return String(t).trim().split("&").reduce(function(t,e){e=e.split("=");var n=e[0].length?decodeURIComponent(e[0]):null,r=e[1]&&e[1].length?decodeURIComponent(e[1]):true;if(n){if(f.call(t,n)){if(t[n].push)t[n].push(r);else t[n]=[t[n],r]}else{t[n]=r}}return t},{})}function i(t){return Array.from(n.keys()).reduce(function(t,e){return t[e]=n.getAll(e),t},{})}function c(t){return String(t).trim().split(e).reduce(function(t,e){e=e.trim();if(e.length){var n=e.split(": "),r=n.shift(),s=n.join(": ");t[r.toLowerCase()]=s}return t},{})}function o(n){return Array.from(n.keys()).reduce(function(t,e){t[e.toLowerCase()]=n.get(e);return t},{})}function p(t,e){return"function"===typeof t?function(){return t(e)}:function(){return e}}function y(r,s){setTimeout(function(){for(var t=a.slice(),e=0,n=t.length;e<n;++e)t[e](r,s);r.dispose();s.dispose()},0)}function g(t){this.type=t}function _(t){this.type=t}function u(s){return n.apply(n,arguments).then(function(e){if(a.length){var n=new g("fetch"),r=new _("fetch");e.text().then(function(t){r.setStatus(e.status).setHeaders(p(o,e.headers)).setBody(t);if(s instanceof window.Request){n.setMethod(s.method).setUrl(s.url).setHeaders(p(o,s.headers));s.text().then(function(t){n.setBody(t||"");y(n,r)})}else{n.setMethod("GET").setUrl(s).setHeaders(p(null,{})).setBody("");y(n,r)}})}return e})}function l(r,s){var i=this,o=null,u={},t=d.prototype.send,l=d.prototype.setRequestHeader;i.send=function(){if(arguments.length)o=arguments[0];t.apply(i,arguments)};i.setRequestHeader=function(t,e){var n=String(t).toLowerCase();u[n]=f.call(u,n)?u[n]+", "+String(e):String(e);l.apply(i,arguments)};if(arguments.length<1)r="GET";if(arguments.length<2)s="";i.addEventListener("load",function t(){i.removeEventListener("load",t);if(a.length){var e=new g("xhr"),n=new _("xhr");e.setMethod(r).setUrl(s).setHeaders(p(null,u)).setBody(null==o?"":o);n.setStatus(i.status).setHeaders(p(c,i.getAllResponseHeaders())).setBody(i.responseText);y(e,n)}});h.apply(i,arguments)}return g.prototype={constructor:g,type:"",_method:"GET",_url:null,_headers:null,_body:null,dispose:function(){return this._method=null,this._url=null,this._headers=null,this._body=null,this},setMethod:function(t){return this._method=String(t).toUpperCase(),this},getMethod:function(){return this._method},setUrl:function(t){return this._url=t,this},getUrl:function(t){var e=this._url;return!0===t?e:e?(t=e.split("?"))[1]?(t[1]=t[1].split("#"),t[1][1]?{url:t[0],search:s(t[1][0]),hash:t[1][1]}:{url:t[0],search:s(t[1][0]),hash:null}):(t[0]=t[0].split("#"),t[0][1]?{url:t[0][0],search:null,hash:t[0][1]}:{url:e,search:null,hash:null}):void 0},setHeaders:function(t){return this._headers=t,this},getHeaders:function(){var t=this._headers;if(t)return t()},setBody:function(t){return this._body=t,this},getBody:function(t){var n,e=this._body;if(!0===t)return e;if(e){if(window.FormData&&e instanceof window.FormData)return n=e,Array.from(n.keys()).reduce(function(t,e){return t[e]=n.getAll(e),t},{});t=String(this.getHeaders()["content-type"]||"");return-1!==t.indexOf("application/x-www-form-urlencoded")?s(e):-1!==t.indexOf("application/json")||-1!==t.indexOf("application/vnd.api+json")?JSON.parse(e):e}}},r.Request=g,_.prototype={constructor:_,type:"",_status:0,_headers:null,_body:null,dispose:function(){return this._status=null,this._headers=null,this._body=null,this},setStatus:function(t){return this._status=t,this},getStatus:function(){return this._status},setHeaders:function(t){return this._headers=t,this},getHeaders:function(){var t=this._headers;if(t)return t()},setBody:function(t){return this._body=t,this},getBody:function(t){var e=this._body;if(!0===t)return e;if(e){t=String(this.getHeaders()["content-type"]||"");return-1!==t.indexOf("application/json")||-1!==t.indexOf("application/vnd.api+json")?JSON.parse(e):e}}},r.Response=_,(l.ajaxListener=u.ajaxListener=r).install=function(){return t||(t=!0,n&&(n.ajaxListener&&(n.ajaxListener.uninstall(),n=window.fetch),window.fetch=u),d&&(d.prototype.open.ajaxListener&&d.prototype.open.ajaxListener.uninstall(),h=d.prototype.open,d.prototype.open=l)),r},r.isInstalled=function(){return t},r.uninstall=function(){return t&&(n&&(window.fetch=n),d&&(d.prototype.open=h),h=null,t=!1),r},r.onRequest=function(t,e){var n;return"function"==typeof t&&(n=a.indexOf(t),!1===e?-1!==n&&a.splice(n,1):-1===n&&a.push(t)),r},r}(),"function"==typeof define&&define.amd&&define(function(t){return e[n]})}("undefined"!=typeof self?self:this,"AjaxListener");