/**
*
* AjaxListener.js: listen to any AJAX event on page, even by other scripts
* version 1.2.0
* https://github.com/foo123/AjaxListener.js
*
**/
!function(e,t){"use strict";e[t]=function(){"use strict";var r={VERSION:"1.2.0"},d=[],n=false,l=Object.prototype.hasOwnProperty,e=Object.prototype.toString,t=Function.prototype.toString,o=/[\r\n]+/,i=/^[^\[\]\.]+(\[[^\[\]\.]+\])+(\[\])?$/,u=/\[([^\[\]]+)\]/g,f=/^\s*function\s*[A-Za-z0-9_$]+\s*\([^\(\)]*\)\s*\{\s*\[native code\]\s*\}\s*$/i,s=window.fetch,c=window.XMLHttpRequest,h=window.Request,a,p,g;function w(){return window.location.origin+window.location.pathname}function y(n){return"[object String]"===e.call(n)}function m(n){return"function"===typeof n&&f.test(t.call(n))}function v(n){return window.FormData&&n instanceof window.FormData}function L(n){return i.test(n)?n.replace(u,".$1").split(".").map(function(n){return decodeURIComponent(n)}):[decodeURIComponent(n)]}function R(n,e,t){for(var r,o=0,i=e.length;o<i;++o){r=e[o];if(o+1<i){if(!l.call(n,r))n[r]={};n=n[r]}else{if("[]"===r.slice(-2))r=r.slice(0,-2);if(l.call(n,r))if(n[r].push)n[r].push(t);else n[r]=[n[r],t];else n[r]=t}}}function x(n,e){return String(n).trim().split("&").reduce(function(n,e){e=e.split("=");var t=e[0].length?L(e[0]):null;if(t&&t.length)R(n,t,e[1]?e[1].length?decodeURIComponent(e[1]):"":true);return n},e||{})}function j(n){return JSON.parse(n)}function O(r,n){return Array.from(r.keys()).reduce(function(n,e){var t=r.getAll(e);n[e]=1===t.length?t[0]:t;return n},n||{})}function S(n){return String(n).trim().split(o).reduce(function(n,e){e=e.trim();if(e.length){var t=e.split(": "),r=t.shift(),o=t.join(": ");n[r.toLowerCase()]=o}return n},{})}function b(t){return Array.from(t.keys()).reduce(function(n,e){n[e.toLowerCase()]=t.get(e);return n},{})}function q(t){return"function"===typeof t.keys&&"function"===typeof t.get?b(t):Object.keys(t).reduce(function(n,e){n[e.toLowerCase()]=t[e];return n},{})}function P(n,e){return"function"===typeof n?function(){return n(e)}:function(){return e}}function U(r,o){setTimeout(function(){for(var n=d.slice(),e=0,t=n.length;e<t;++e)n[e](r,o);r.dispose();o.dispose();r=null;o=null},0)}function A(n,e,t,r,o){var i=this,u=null,l=null,f=null;e=String(e).toUpperCase();i.dispose=function(){t=null;r=null;o=null;e=null;u=null;l=null;f=null;return i};i.getAPI=function(){return n};i.getMethod=function(){return e};i.getURL=function(n){if(true===n)return t;if(null==u&&null!=t){var e=new window.URL(t,w());u={href:e.href,origin:e.origin,hostname:e.hostname,protocol:e.protocol,host:e.host,port:e.port,path:e.pathname,query:e.search,hash:e.hash,queryParams:e.search&&e.search.length?x(e.search.slice(1)):{}}}return u};i.getHeaders=function(){if(null==l&&null!=r)l=r();return l};i.getBody=function(n){if(true===n)return o;if(null==f&&null!=o)if(v(o))f=O(o);else if(y(o)){var e=String(i.getHeaders()["content-type"]||"");if(-1!==e.indexOf("application/x-www-form-urlencoded"))f=x(o);else if(-1!==e.indexOf("application/json")||-1!==e.indexOf("application/vnd.api+json"))f=j(o);else f=o}else f=o;return f}}function H(n,e,t,r,o){var i=this,u=null,l=null,f=null;i.dispose=function(){e=null;t=null;r=null;o=null;u=null;l=null;f=null;return i};i.getAPI=function(){return n};i.getStatus=function(){return e};i.getURL=function(n){if(true===n)return t;if(null==u&&null!=t){var e=new window.URL(t,w());u={href:e.href,origin:e.origin,hostname:e.hostname,protocol:e.protocol,host:e.host,port:e.port,path:e.pathname,query:e.search,hash:e.hash,queryParams:e.search&&e.search.length?x(e.search.slice(1)):{}}}return u};i.getHeaders=function(){if(null==l&&null!=r)l=r();return l};i.getBody=function(n){if(true===n)return o;if(null==f&&null!=o)if(y(o)){var e=String(i.getHeaders()["content-type"]||"");if(-1!==e.indexOf("application/x-www-form-urlencoded"))f=x(o);else if(-1!==e.indexOf("application/json")||-1!==e.indexOf("application/vnd.api+json"))f=j(o);else f=o}else f=o;return f}}function B(n,e){var t=new h(n,e),r=e?e.body:"";t.getOriginalBody=function(){return r};return t}function E(a){var n=arguments,p=(1<n.length?n[1]:{})||{};return new Promise(function(c,e){s.apply(window,n).then(function(r){if(d.length){var n=r.arrayBuffer,o=r.blob,i=r.formData,u=r.json,l=r.text,f=r.body,e=null,t=false,s=function n(){clearTimeout(e);if(t)return;t=true;setTimeout(function(){U(a instanceof h?new A("fetch",a.method,a.url,P(b,a.headers),a.getOriginalBody?a.getOriginalBody():a.body):new A("fetch",p.method||"GET",a,P(q,p.headers||{}),p.body||""),new H("fetch",r.status,r.url||a.url,P(b,r.headers),f))},0)};e=setTimeout(s,500);r.arrayBuffer=function(){return new Promise(function(e,t){n.call(r).then(function(n){f=n;s();e(n)}).catch(function(n){s();t(n)})})};r.blob=function(){return new Promise(function(e,t){o.call(r).then(function(n){f=n;s();e(n)}).catch(function(n){s();t(n)})})};r.formData=function(){return new Promise(function(e,t){i.call(r).then(function(n){f=n;s();e(n)}).catch(function(n){s();t(n)})})};r.json=function(){return new Promise(function(e,t){u.call(r).then(function(n){f=n;s();e(n)}).catch(function(n){s();t(n)})})};r.text=function(){return new Promise(function(e,t){l.call(r).then(function(n){f=n;s();e(n)}).catch(function(n){s();t(n)})})}}c(r)}).catch(function(n){e(n)})})}function I(t,r){var o=this,i=null,u={},n;o.send=function(){if(arguments.length)i=arguments[0];return p.apply(o,arguments)};o.setRequestHeader=function(n,e){var t=String(n).toLowerCase();u[t]=l.call(u,t)?u[t]+", "+String(e):String(e);return g.apply(o,arguments)};n=function n(e){o.removeEventListener("load",n);o.removeEventListener("error",n);o.removeEventListener("abort",n);if("load"===e.type&&d.length)U(new A("xhr",t,r,P(null,u),null==i?"":i),new H("xhr",o.status,o.responseURL&&o.responseURL.length?o.responseURL:r,P(S,o.getAllResponseHeaders()),o.responseText))};o.addEventListener("load",n);o.addEventListener("error",n);o.addEventListener("abort",n);if(arguments.length<1)t="GET";if(arguments.length<2)r="";return a.apply(o,arguments)}return A.prototype={constructor:A,dispose:null,getAPI:null,getMethod:null,getURL:null,getHeaders:null,getBody:null},r.Request=A,H.prototype={constructor:H,dispose:null,getAPI:null,getStatus:null,getURL:null,getHeaders:null,getBody:null},r.Response=H,(I.ajaxListener=E.ajaxListener=r).install=function(){if(!n){if(s){if(s.ajaxListener){s.ajaxListener.uninstall();s=window.fetch;h=window.Request}if(m(s)){window.fetch=E;if(m(h))window.Request=B;n=true}}if(c){if(c.prototype.open.ajaxListener)c.prototype.open.ajaxListener.uninstall();if(m(c.prototype.open)){a=c.prototype.open;p=c.prototype.send;g=c.prototype.setRequestHeader;c.prototype.open=I;n=true}}}return r},r.isInstalled=function(){return n},r.uninstall=function(){if(n){if(m(s)){window.fetch=s;window.Request=h}if(m(a))c.prototype.open=a;a=null;p=null;g=null;n=false}return r},r.onRequest=function(n,e){if("function"===typeof n){var t=d.indexOf(n);if(false===e){if(-1!==t)d.splice(t,1)}else if(-1===t)d.push(n)}return r},r}(),"function"==typeof define&&define.amd&&define(function(n){return e[t]})}("undefined"!=typeof self?self:this,"AjaxListener");